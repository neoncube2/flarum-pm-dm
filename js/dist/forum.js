(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=e.n(t);const s=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/IndexPage"];var o=e.n(a);const i=flarum.core.compat["forum/components/NotificationGrid"];var r=e.n(i);function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}const l=flarum.core.compat["common/Model"];var p=e.n(l);const h=flarum.core.compat["common/utils/mixin"];var d=e.n(h),v=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t.prototype.apiEndpoint=function(){return"/neoncube-private-messages/messages"+(this.exists?"/"+this.data.id:"")},t}(d()(p(),{message:p().attribute("message"),user:p().hasOne("user"),isHidden:p().attribute("isHidden"),createdAt:p().attribute("createdAt",p().transformDate),conversation:p().hasOne("conversation"),number:p().hasOne("number")})),f=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t.prototype.apiEndpoint=function(){return"/neoncube-private-messages/conversations"+(this.exists?"/"+this.data.id:"")},t}(d()(p(),{messages:p().hasMany("messages"),recipients:p().hasMany("recipients"),totalMessages:p().attribute("totalMessages"),notNew:p().attribute("notNew"),createdAt:p().attribute("createdAt",p().transformDate),updatedAt:p().attribute("updatedAt",p().transformDate)})),g=function(e){function t(){return e.apply(this,arguments)||this}return u(t,e),t}(d()(p(),{conversation:p().hasOne("conversation"),user:p().hasOne("user"),userId:p().attribute("userId"),conversationId:p().attribute("conversationId"),lastRead:p().attribute("lastRead")}));const y=flarum.core.compat["common/models/User"];var b=e.n(y);const w=flarum.core.compat["common/components/Page"];var N=e.n(w);const M=flarum.core.compat["common/components/Button"];var I=e.n(M);const T=flarum.core.compat["common/Component"];var R=e.n(T);const C=flarum.core.compat["common/helpers/avatar"];var x=e.n(C);const A=flarum.core.compat["common/helpers/username"];var k=e.n(A);const _=flarum.core.compat["common/helpers/humanTime"];var P=e.n(_);const D=flarum.core.compat["common/components/LoadingIndicator"];var O=e.n(D),L=function(e){function t(){return e.apply(this,arguments)||this}u(t,e),t.initAttrs=function(e){null!=e.className||(e.className=""),null!=e.content||(e.content=""),null!=e.preview||(e.preview=!1)};var n=t.prototype;return n.view=function(){return m("div",{className:this.attrs.className})},n.oncreate=function(t){var n=this;if(e.prototype.oncreate.call(this,t),this.attrs.preview){var s,a=function(){var e=n.attrs.content;s!==e&&(s=e,s9e.TextFormatter.preview(e||"",t.dom))};a(),this.updateInterval=setInterval(a,50)}else s9e.TextFormatter.preview(this.attrs.content,t.dom)},n.onremove=function(){clearInterval(this.updateInterval)},t}(R());const S=flarum.core.compat["common/utils/Stream"];var B=e.n(S);const H=flarum.core.compat["common/utils/withAttr"];var q=e.n(H);const U=flarum.core.compat["common/helpers/icon"];var j=e.n(U),F=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var s=t.prototype;return s.oninit=function(e){var t=this;this.loading=!0,this.vnode=e,this.idParam=m.route.param("id"),this.firstLoad=!0,this.typingTimeout=!0,this.sendTimeout=!0;var n=function(){t.typingTimeout=!0,setTimeout((function(){n()}),5e3)},s=function(){t.typingTime<new Date(Date.now()-6e3)&&(t.typing=!1,m.redraw()),setTimeout((function(){s()}),6e3)};this.sendTimeoutInterval=function(){if(0===t.timer)return t.sendTimeout=!0,void m.redraw();t.timer--,t.timer>=0&&setTimeout((function(){t.sendTimeoutInterval()}),1e3)},n(),s(),this.typing=!1,null!=this.conversation||(this.conversation=e.attrs.conversation),this.initPost()},s.initPost=function(){return this.newMessageCount=0,this.load(),this.messageContent=B()(""),new Promise((function(){setTimeout((function(){$(".chat-history").animate({scrollTop:$(".chat-history").prop("scrollHeight")},1e3)}),500)}))},s.onremove=function(){n().pusher&&n().pusher.then((function(e){var t=e.channels;t.user.unbind("typing"),t.user.unbind("newMessage")}))},s.onupdate=function(){var e=this;$(".chat-history").scroll((function(){if(!e.notNew&&0===$(".chat-history").scrollTop()){var t=$(".message-content:first");e.getMessages(n().cache.messages[e.conversation.id()].length),e.notNew||$(".chat-history").scrollTop(t.offset().top)}}))},s.onbeforeupdate=function(){var e=this;$(".UserListItem").off("click").on("click",(function(t){e.conversation=n().cache.conversations[$(t.currentTarget).attr("id")],e.index=$(t.currentTarget).attr("id"),e.notNew=!1,e.cipher=null,e.oninit(e.vnode),m.redraw()})),$("#MessageTextArea").off().on("keydown",(function(t){console.log(n().forum),13===t.keyCode&&n().forum.attribute("neoncubePrivateMessagesReturnKey")&&($("#MessageTextArea").prop("disabled",!0),e.sendMessage())}))},s.oncreate=function(){var e=this;n().pusher&&n().pusher.then((function(t){var n=t.channels;n.user.bind("newMessage",(function(t){if(parseInt(t.conversationId)===parseInt(e.conversation.id())&&$(".MessagesDropdown").children(".Dropdown-menu").is(":visible")){var n={id:B()(t.id),message:B()(t.message),user:B()(e.user),createdAt:B()(t.createdAt)};e.decryptMessages([n]),e.newMessageCount++,e.typing=!1,m.redraw(),$(".chat-history").animate({scrollTop:$(".chat-history").prop("scrollHeight")},1e3)}})),n.user.bind("typing",(function(t){if(parseInt(t.conversationId)===parseInt(e.conversation.id())){var n=$(".chat-history"),s=n.scrollTop()+n.innerHeight()>=n[0].scrollHeight-50;e.typing=!0,e.typingTime=new Date,m.redraw(),s&&n.animate({scrollTop:$(".chat-history").prop("scrollHeight")},400)}})),n.user.bind("readMessage",(function(t){parseInt(t.conversationId)===parseInt(e.conversation.id())&&(e.recipient.lastRead=m.prop(t.number),m.redraw())}))}))},s.view=function(){var e=this,t=n().cache.messages?n().cache.messages[this.conversation.id()]:[];return m("div",{style:this.idParam&&this.isMobile()?"width: 100%":"",className:"chat"},m("div",{className:"chat-header clearfix"},x()(this.user),m("div",{className:"chat-about"},m("div",{className:"chat-with"},n().translator.trans("neoncube-private-messages.forum.chat.chat_with",{username:k()(this.user)})),m("div",{className:"chat-num-messages"},n().translator.trans("neoncube-private-messages.forum.chat.messages_"+(parseInt(this.conversation.totalMessages())>1?"multiple":"single"),{count:this.conversation.totalMessages()+this.newMessageCount})))),(null==t?void 0:t.length)>0&&!this.loading?[m("div",{className:"chat-history"},m("ul",null,this.notNew?m("li",{className:"startConvo"},n().translator.trans("neoncube-private-messages.forum.chat.start_of_conversation")):"",t?t.filter((function(e,t,n){return t===n.findIndex((function(t){return t.message()===e.message()}))})).sort((function(e,t){return e.createdAt()-t.createdAt()})).map((function(t,s){var a=parseInt(t.user().id())===parseInt(n().session.user.id());return m("li",{className:"clearfix message-content"},m("div",{className:"message-data "+(a?"align-right":"")},m("div",{className:"avatar-inline "+(a?"me":"other")},x()(a?n().session.user:t.user())),m("span",{className:"message-data-name"},k()(a?n().session.user:t.user())),m("span",{className:"message-data-time"},P()(t.createdAt()))),m(L,{content:t.message(),className:"message "+(a?"my-message float-right":"other-message")}),a&&parseInt(e.recipient.lastRead())>=parseInt(t.data.attributes.number)?m("span",{className:"message-read"},j()("fas fa-check")):"")})):"",this.messageContent()?m("li",null,m(L,{content:this.messageContent(),className:"message my-message float-right message-preview",preview:!0})):"",this.typing?m("li",null,m("div",{className:"tiblock"},m("div",{className:"tidot"}),m("div",{className:"tidot"}),m("div",{className:"tidot"}))):""))]:m(O(),{display:"block",size:"medium"}),m("form",{className:"chat-message clearfix"},m("textarea",{id:"MessageTextArea",value:this.messageContent(),oninput:q()("value",this.typingPush.bind(this)),placeholder:n().translator.trans("neoncube-private-messages.forum.chat.text_placeholder"),rows:"3"}),I().component({onclick:this.sendMessage.bind(this),className:"Button Button--primary",disabled:!this.messageContent()||!this.sendTimeout},n().translator.trans("neoncube-private-messages.forum.chat.send"))))},s.typingPush=function(e){var t=this;this.messageContent(e),m.redraw(),this.typingTimeout&&n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/neoncube-private-messages/messages/typing",body:{conversationId:this.conversation.id(),userId:this.user.id()}}).then((function(){t.typingTimeout=!1}))},s.sendMessage=function(){var e=this;this.sendTimeout&&""!==this.messageContent()&&this.messageContent().replace(/\s/g,"").length&&(this.sendTimeout=!1,this.timer=1,this.sendTimeoutInterval(),this.newMessageCount++,n().store.createRecord("messages").save({messageContents:this.messageContent(),conversationId:this.conversation.id()}).then((function(t){n().cache.messages[e.conversation.id()].push(t),m.redraw(),e.messageContent(""),$(".chat-history").animate({scrollTop:$(".chat-history").prop("scrollHeight")},500),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/neoncube-private-messages/messages/read",body:{conversationId:e.conversation.id(),messageId:t.id()}})})))},s.getMessages=function(e){var t=this;void 0===e&&(e=0),this.notNew||n().store.find("neoncube-private-messages/messages",this.conversation.id(),{offset:e}).then((function(e){var s;if(delete e.payload,t.firstLoad){var a=t.meRecipient.lastRead();n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/neoncube-private-messages/messages/read",body:{conversationId:t.conversation.id(),messageId:e[0].id()}}).then((function(e){var s=e.data.attributes.lastRead,o=n().session.user.unreadMessages(),i=0===o?0:o-(s-a);i>=0&&(n().session.user.pushAttributes({unreadMessages:i}),m.redraw()),t.firstLoad=!1}))}(s=n().cache.messages[t.conversation.id()]).push.apply(s,e),e.length<20&&(t.notNew=!0)})).then((function(){t.loading=!1,m.redraw()}))},s.load=function(){var e,t,s,a=this;this.loading=!0,m.redraw(),null!=(e=n().cache).messages||(e.messages=[]),this.conversation.recipients().map((function(e){parseInt(e.user().id())!==parseInt(n().session.user.id())?(a.user=e.user(),a.recipient=e):a.meRecipient=e})),null!=(t=n().cache.messages)[s=this.conversation.id()]||(t[s]=[]),this.getMessages()},s.isMobile=function(){return this.vnode.attrs.mobile},t}(R());const z=flarum.core.compat["common/helpers/userOnline"];var E=e.n(z),G=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var s=t.prototype;return s.oninit=function(t){var s,a=this;this.conversation=t.attrs.conversation,this.user=null;var o=parseInt(n().session.user.id());this.user=null==(s=this.conversation.recipients().find((function(e){return parseInt(e.user().id())!==o})))?void 0:s.user(),m.redraw();var i=function(){a.typingTime<new Date(Date.now()-6e3)&&(a.typing=!1,m.redraw()),setTimeout((function(){i()}),6e3)};i(),e.prototype.oncreate.call(this,t)},s.onremove=function(t){n().pusher&&n().pusher.then((function(e){e.channels.user.unbind("typing")})),e.prototype.onremove.call(this,t)},s.oncreate=function(t){var s=this;n().pusher&&n().pusher.then((function(e){e.channels.user.bind("typing",(function(e){parseInt(e.conversationId)===parseInt(s.conversation.id())&&(s.typing=!0,s.typingTime=new Date,m.redraw())}))})),e.prototype.oncreate.call(this,t)},s.view=function(e){return this.user?m("li",{id:e.attrs.index,className:e.attrs.active?"UserListItem active":"UserListItem",onclick:e.attrs.onclick},m("div",{className:"UserListItem-content"},x()(this.user),m("div",{className:"info"},k()(this.user),E()(this.user)),this.typing&&m("div",{className:"tiblock"},m("div",{className:"tidot"})))):null},t}(R());const K=flarum.core.compat["common/components/Modal"];var J=e.n(K);const Q=flarum.core.compat["forum/components/Search"];var V=e.n(Q);const W=flarum.core.compat["common/helpers/highlight"];var X=e.n(W),Y=function(){function e(){}var t=e.prototype;return t.view=function(e){var t,n=this;if(!(e.length<3||this.loading)){if(null!=(t=app.cache).conversationResults||(t.conversationResults=[]),this.query=e,app.cache.conversationResults[this.query])return[m("li",{className:"Dropdown-header"},app.translator.trans("core.forum.search.users_heading")),app.cache.conversationResults[this.query].map((function(e){var t=k()(e);return t=X()(t.text,n.query),m("li",{className:"SearchResult","data-index":e.id()},m("a",{"data-index":"users:"+e.id()},x()(e),t))}))];this.loading=!0,app.cache.conversationResults[this.query]=[],app.store.find("users",{filter:{q:this.query},page:{limit:5}}).then(this.pushResults.bind(this))}},t.pushResults=function(e){var t=this;e.payload.data.map((function(e){var n=app.store.getById("users",e.id);parseInt(n.id())!==parseInt(app.session.user.id())&&app.cache.conversationResults[t.query].push(n)})),this.loading=!1,m.redraw()},e}();const Z=flarum.core.compat["common/utils/ItemList"];var ee=e.n(Z);const te=flarum.core.compat["common/utils/classList"];var ne=e.n(te);const se=flarum.core.compat["common/utils/extractText"];var ae=e.n(se);const oe=flarum.core.compat["common/utils/extract"];var ie=e.n(oe),re=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var s=t.prototype;return s.oninit=function(t){this.value=B()(),e.prototype.oninit.call(this,t)},s.updateMaxHeight=function(){},s.view=function(){var e=this;null==this.value&&this.value("");var t=this.value()&&this.value().length>=3;return null!=this.sources||(this.sources=this.sourceItems().toArray()),m("div",{className:"AddRecipientModal-body"},null===n().cache.conversationsRecipient?m("div",{className:"AddRecipientModal-form-input"},m("input",{className:ne()("RecipientsInput FormControl",{open:!!this.value(),focused:!!this.value(),active:!!this.value(),loading:!!this.loadingSources}),config:function(e){e.focus()},type:"search",placeholder:ae()(n().translator.trans("neoncube-private-messages.forum.modal.search_recipients")),value:this.value(),oninput:q()("value",this.value),onfocus:function(){return e.hasFocus=!0},onblur:function(){return e.hasFocus=!1},onkeyup:function(){clearTimeout(e.typingTimer),e.doSearch=!1,e.typingTimer=setTimeout((function(){e.doSearch=!0,m.redraw()}),900)},onkeydown:function(){clearTimeout(e.typingTimer)}}),m("ul",{className:ne()("Dropdown-menu Search-results fade",{in:!!t}),onclick:function(){var t=e.$(".SearchResult.active");e.addRecipient(t.data("index")),e.$(".RecipientsInput").trigger("focus")}},this.doSearch?this.sources.map((function(t){return t.view(e.value())})):O().component({size:"tiny",className:"Button Button--icon Button--link"}),m("li",null,m("span",null,n().translator.trans("neoncube-private-messages.forum.modal.more_users"))))):m("div",{className:"RecipientsInput-selected RecipientsLabel"},function(e,t){var n;void 0===t&&(t={}),null!=(n=t).style||(n.style={}),t.className="RecipientLabel "+(t.className||"");var s=ie()(t,"link");return m(s?"a":"span",t,m("span",{className:"RecipientLabel-text"},x()(e),k()(e)))}(n().cache.conversationsRecipient,{onclick:function(){e.removeRecipient(n().cache.conversationsRecipient)}})))},s.sourceItems=function(){var e=new(ee());return e.add("users",new Y),e},s.clear=function(){this.value(""),m.redraw()},s.addRecipient=function(e){n().cache.conversationsRecipient=n().store.getById("users",e),this.clear()},s.removeRecipient=function(e){n().cache.conversationsRecipient=null,m.redraw()},s.findRecipient=function(e,t){return n().store.getById(e,t)},t}(V()),ce=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),n().cache.conversationsRecipient=null,this.conversations=this.attrs.conversations,this.already=!1,this.messageContent=B()("")},s.title=function(){return n().translator.trans("neoncube-private-messages.forum.modal.title")},s.className=function(){return"StartConversationModal Modal--medium"},s.content=function(){return[m("div",{className:"Modal-body",onclick:function(e){return e.stopImmediatePropagation()}},this.already?[m("h2",null,n().translator.trans("neoncube-private-messages.forum.modal.already",{username:k()(this.recpient)})),m("h2",null,n().translator.trans("neoncube-private-messages.forum.modal.copied",{username:k()(this.recpient)}))]:m("div",null,m("div",{class:"helpText"},null!==n().cache.conversationsRecipient?n().translator.trans("neoncube-private-messages.forum.modal.help_start",{username:k()(n().cache.conversationsRecipient)}):n().translator.trans("neoncube-private-messages.forum.modal.help")),m("div",{className:"AddRecipientModal-form"},m(re,{state:n().search}),null!==n().cache.conversationsRecipient?m("div",{className:"AddRecipientModal-form-submit"},m("textarea",{value:this.messageContent(),oninput:q()("value",this.messageContent),placeholder:n().translator.trans("neoncube-private-messages.forum.chat.text_placeholder"),rows:"3"}),I().component({type:"submit",className:"Button Button--primary",disabled:!this.messageContent()},n().translator.trans("neoncube-private-messages.forum.modal.submit"))):"")))]},s.onsubmit=function(e){var t=this;e.preventDefault();var s=n().cache.conversationsRecipient;this.recpient=s,n().cache.conversationsRecipient=null,n().store.createRecord("conversations").save({messageContents:this.messageContent(),recipient:s.id()}).then((function(e){if(e.notNew()){var s=document.createElement("textarea");document.body.appendChild(s),s.value=t.messageContent(),s.focus(),s.select(),document.execCommand("Copy"),s.remove(),t.already=!0,m.redraw()}else t.conversations.push(e),m.redraw(),n().modal.close()}))},t}(J()),ue=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var s=t.prototype;return s.oninit=function(e){this.mobile=e.attrs.mobile,this.load(),this.loading=!1},s.onupdate=function(){},s.onbeforeupdate=function(){var e=this,t=$(".ConversationsList-list");t.off("scroll").on("scroll",(function(){t.scrollTop()+t.innerHeight()>=t[0].scrollHeight&&e.loadMore()}))},s.view=function(){var e=this;if(!this.loading){var t=n().cache.conversations;null===this.currentConversation&&(null==t?void 0:t.length)>0&&(this.currentConversation=t[0]),this.currentConversation&&(this.conversationComponent=F.component({conversation:this.currentConversation,mobile:this.mobile}));var s=(null==t?void 0:t.length)>0;return m("div",{className:"ConversationsList"},m("div",{style:s?"":"width: unset; padding: 10px;",className:"container clearfix"},m("div",{style:this.mobile?"float: unset; margin: 0 auto; display: block;":"",className:"people-list",id:"people-list"},I().component({onclick:this.showModal.bind(this),className:"Button Button--primary",disabled:!n().forum.attribute("canMessage")},n().forum.attribute("canMessage")?n().translator.trans("neoncube-private-messages.forum.chat.start"):n().translator.trans("neoncube-private-messages.forum.chat.cant_start")),s&&m("ul",{className:"ConversationsList-list"},Array.isArray(t)&&t.map((function(t,s){return m(G,{conversation:t,index:s,active:!e.mobile&&e.currentConversation===t,onclick:function(t){e.mobile?m.route(n().route("messages",{id:n().cache.conversations[$(t.currentTarget).attr("id")].id()})):(e.currentConversation=n().cache.conversations[$(t.currentTarget).attr("id")],m.redraw())}})})))),!this.mobile&&this.conversationComponent))}},s.showModal=function(){n().modal.show(ce,{conversations:n().cache.conversations,messages:n().cache.messages})},s.loadMore=function(){var e=this;this.loading=!0,m.redraw(),n().store.find("neoncube-private-messages/conversations",{offset:n().cache.conversations.length}).then((function(e){delete e.payload,e.map((function(e){n().cache.conversations.push(e)}))})).catch((function(){})).then((function(){e.loading=!1,m.redraw()}))},s.load=function(){var e=this;n().cache.conversations&&!this.mobile||(this.mobile&&(n().cache.conversations=[]),this.loading=!0,m.redraw(),n().store.find("neoncube-private-messages/conversations").then((function(e){delete e.payload,n().cache.conversations=e})).catch((function(){})).then((function(){e.loading=!1,m.redraw()})))},t}(R()),me=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var n=t.prototype;return n.oninit=function(){e.prototype.oninit.call(this),app.history.push("messages"),this.bodyClass="App--conversations"},n.view=function(){return m("div",{className:"ConversationsPage"},m(ue,{mobile:!0}))},t}(N()),le=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var n=t.prototype;return n.init=function(){var t=this;e.prototype.init.call(this),app.history.push("conversations");var n=m.route.param("id");app.store.find("neoncube-private-messages/conversations",n).then((function(e){app.cache.conversations=[e],t.list=F.component({conversation:e,mobile:!0}),m.redraw()})),this.bodyClass="App--messages"},n.view=function(){return m("div",{className:"MessagesPage"},m("div",{className:"ConversationsList"},m("div",{className:"container clearfix"},this.list?this.list:null)))},t}(N());const pe=flarum.core.compat["forum/components/Notification"];var he=function(e){function t(){return e.apply(this,arguments)||this}u(t,e);var n=t.prototype;return n.icon=function(){return"fas fa-message"},n.href=function(){var e=this.attrs.notification,t=e.subject(),n=e.content()||{};return app.route.discussion(t,n.postNumber)},n.content=function(){return app.translator.trans("neoncube-private-messages.forum.notifications.message_received",{user:this.attrs.notification.fromUser()})},t}(e.n(pe)());const de=flarum.core.compat["forum/components/HeaderSecondary"];var ve=e.n(de);const fe=flarum.core.compat["forum/components/NotificationsDropdown"];var ge=function(e){function t(){return e.apply(this,arguments)||this}u(t,e),t.initAttrs=function(t){t.label||(t.label=n().translator.trans("neoncube-private-messages.forum.dropdown.tooltip")),t.icon||(t.icon="fas fa-comment-alt"),t.className="MessagesDropdown NotificationsDropdown",e.initAttrs.call(this,t)};var s=t.prototype;return s.onclick=function(){n().drawer.isOpen()&&this.goToRoute()},s.getMenu=function(){return m("form",{className:"Dropdown-menu "+this.attrs.menuClassName},this.showing&&m(ue,{mobile:!1}))},s.goToRoute=function(){m.route(n().route("conversations"))},s.getUnreadCount=function(){return n().session.user.unreadMessages()},s.getNewCount=function(){return this.getUnreadCount()},t}(e.n(fe)());n().initializers.add("neoncube-private-messages",(function(e){e.store.models.messages=v,e.store.models.conversations=f,e.store.models.conversation_users=g,b().prototype.conversations=p().hasMany("conversations"),b().prototype.unreadMessages=p().attribute("unreadMessages"),e.notificationComponents.privateMessageReceived=he,e.routes.conversations={path:"/neoncube-private-messages/conversations",component:me},e.routes.messages={path:"/neoncube-private-messages/messages/:id",component:le},(0,s.extend)(ve().prototype,"items",(function(e){n().forum.attribute("canMessage")&&e.add("Messages",m(ge,null),20)})),(0,s.extend)(o().prototype,"oncreate",(function(){e.pusher&&e.pusher.then((function(t){var n=t.channels;n.user&&n.user.bind("newMessage",(function(t){e.session.user.unreadMessages=B()(e.session.user.unreadMessages()+1),m.redraw()}))}))})),(0,s.extend)(o().prototype,"onremove",(function(){e.pusher&&e.pusher.then((function(e){var t=e.channels;t.user&&t.user.unbind("newMessage")}))})),(0,s.extend)(r().prototype,"notificationTypes",(function(t){t.add("privateMessgeReceived",{name:"privateMessgeReceived",icon:"fas fa-comment-alt",label:e.translator.trans("neoncube-private-messages.forum.notifications.notify_message_received")})}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map